<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Home</title>
  <!-- Font Awesome -->

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="/css/mdb.min.css" rel="stylesheet">
  <!-- Your custom styles (optional) -->
  <link href="/css/style.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/webjars/layui/2.5.5/css/layui.css}">
  <script src="/webjars/jquery/3.3.1/jquery.js"></script>
  <script src="/webjars/highcharts/4.0.4/highcharts.js"></script>
  <style>
    #userTable{
      width: 500px;
    }
  </style>
</head>
<body class="grey lighten-3">
  <!--Main Navigation-->
  <header>
    <nav class="navbar fixed-top navbar-expand-lg navbar-light white scrolling-navbar">
      <div class="container-fluid">
        <!-- Brand -->
        <a class="navbar-brand waves-effect"  target="_blank">
          <strong class="blue-text">大学生就业平台</strong>
        </a>

        <!-- Links -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">

          <!-- Left -->
          <ul class="navbar-nav mr-auto">

          </ul>

          <!-- Right -->
          <ul class="navbar-nav nav-flex-icons">
            <li class="nav-item">
              <a href="#" class="nav-link waves-effect" >
                用户名：系统管理员
              </a>
            </li>&nbsp;&nbsp;&nbsp;
            <li class="nav-item">
              <a href="/login/out" class="nav-link waves-effect" >
                退出
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="sidebar-fixed position-fixed">

      <a class="logo-wrapper waves-effect">
        <h2>哈皮招聘</h2>
      </a>

      <div class="list-group list-group-flush">
        <a href="/admin/user.html" class="list-group-item active waves-effect">
          <i class="fas fa-user mr-3"></i>用户信息管理</a>

        <a href="/admin/company.html" class="list-group-item list-group-item-action waves-effect">
        <i class="fas fa-map mr-3"></i>公司信息管理</a>

      </div>

    </div>
    <!-- Sidebar -->

  </header>
  <main class="pt-5 mx-lg-5">
  <div  class="container-fluid mt-5">

    <div id="userToolBar"  style="display: none;">
      <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
      <button class="layui-btn layui-btn-sm" lay-event="deleteall">批量删除</button>

    </div>
    <div  id="userBar" style="display: none;">
      <button class="layui-btn layui-btn-xs" lay-event="edit">编辑</button>
      <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</button>
    </div>
    <form class="layui-form" th:method="post">
      <div align="center">
        <label class=""><b>用户编号</b></label>

        <div class="layui-input-inline">
          <input type="text" id="userid" name="userid"   placeholder="用户编号"  class="layui-input">
        </div>

        <label class=""><b>用户姓名</b></label>
        <div class="layui-input-inline">
          <input type="text" name="username"  id="username"  placeholder="用户姓名"  class="layui-input">
        </div>
        <label class=""><b>电话号码</b></label>
        <div class="layui-input-inline">
          <input type="text" name="usertel" id="usertel"   placeholder="电话号码"  class="layui-input">
        </div>
        <button  type="button" lay-submit="" lay-filter="doSerach" class="layui-btn">查询</button>
      </div>

    </form>
    <div id="did">

      <table class="layui-hide" align="center" id="userTable" lay-filter="userTable"></table>
    </div>
    <!--添加或修改弹出层-->
    <div style="display: none;padding: 20px" id="saveOrUpdateDiv" >
      <form class="layui-form " action="" lay-filter="dataFrm" id="dataFrm">
        <div align="center" class="layui-form-item">
          用户姓名:
          <div class="layui-inline">

            <div class="layui-input-inline">
              <input type="text" name="username"  lay-verify="required|username" autocomplete="off"
                     class="layui-input">
            </div>
          </div>
          电话号码:
          <div class="layui-inline">

            <div class="layui-input-inline">
              <input type="text" name="usertel" autocomplete="off" lay-verify="required|phone"
                     class="layui-input">
            </div>
          </div>
        </div>
        <div align="center" class="layui-form-item">
          出生日期:
          <div class="layui-inline">

            <div class="layui-input-inline">
              <input type="text" name="userbrithday" id="userbrithday"  lay-verify="required" autocomplete="off"
                     class="layui-input">
            </div>
          </div>
          用户密码:
          <div class="layui-inline">

            <div class="layui-input-inline">
              <input type="password" name="userpassword" lay-verify="required" autocomplete="off"
                     class="layui-input">
            </div>
          </div>
        </div>
        <div align="center" class="layui-form-item">
          <div class="layui-inline">
            <label class="layui-form-label">性别:</label>
            <div class="layui-input-inline">
              <input type="radio" name="usersex" value="男" checked="checked" title="男">
              <input type="radio" name="usersex" value="女" title="女">
            </div>
          </div>
        </div>
        <input name="userid" type="hidden">
        <div  class="layui-form-item" style="text-align: center;">
          <div align="center" class="layui-input-block">
            <button type="button" class="layui-btn layui-btn-normal layui-btn-sm layui-icon layui-icon-release" lay-filter="doSubmit" lay-submit="">提交</button>
            <button type="reset" class="layui-btn layui-btn-warm layui-btn-sm layui-icon layui-icon-refresh" >重置</button>
          </div>
        </div>
      </form>

    </div>





    </div>
  </main>


  <script th:src="@{/webjars/layui/2.5.5/layui.js}"></script>
  <script type="text/javascript">
    //Demo
    layui.use(['jquery','layer','table','form','laydate'], function(){
      var $=layui.jquery;
      var layer=layui.layer;
      var table=layui.table;
      var form=layui.form;
      var laydate=layui.laydate;
      form.verify({
        username:[
          /^[\u4e00-\u9fa5]{0,}$/
          ,'用户姓名必须为纯汉字'

        ]
      });
      laydate.render({
        elem:'#userbrithday',
        type:'date'

      });
      $("#btid").click(function () {

      });
      var tableIns=table.render({
        elem: '#userTable'   //渲染的目标对象
        ,url:'/admin/user' //数据接口
        ,title: '用户信息表'//数据导出来的标题
        /* ,toolbar:"<div>xxx</div>" */
        ,toolbar:"#userToolBar"   //表格的工具条
        ,defaultToolbar:['filter','exports']
        /* ,height:300 */
        ,height:'full-200'
        ,width:'1081'
        ,cellMinWidth:100 //设置列的最小默认宽度
        ,done:function(res, curr, count){
          /* alert(res);//后台url返回的json串
          alert(curr);//当前页
          alert(count);//数据总条数 */
        }
        ,totalRow:true //开启合并行
        ,page: true  //是否启用分页
        /*   ,limit:20 //设置每页显示条数 默认为10
          ,limits:[20,40,60,80] */
        ,text:{
          none: '暂无相关数据' //默认：无数据。注：该属性为 layui 2.2.5 开始新增
        }
        ,cols: [
          [   //列表数据
            {type: 'checkbox', fixed: 'left'}
            ,{field:'userid', title:'用户编号', width:120,sort:true}
            ,{field:'username', title:'用户姓名',sort:true,align:'center'}
            ,{field:'usersex', title:'用户性别',sort:true,align:'center'}
            ,{field:'usertel', title:'用户电话',sort:true,align:'center'}
            ,{field:'userpassword', title:'用户密码',sort:true,align:'center'}
            ,{field:'userbrithday', title:'出生日期',sort:true,align:'center'}
            ,{fixed: 'right', title:'操作', toolbar: '#userBar', width:220,align:'center'}

          ]
        ]
      });
      //行工具
      table.on("tool(userTable)",function (obj) {
        switch(obj.event){
          case 'edit':
            openUpdateUser(obj.data);
            break;
          case 'del':
            $.ajax({

              type:"post",
              url:"/admin/deleteuser",
              data:obj.data,
              dataType:"json",
              success:function (data) {
                if("1"==data.code){
                  layer.msg(data.msg);
                  tableIns.reload({
                    url:'/admin/user',
                    page:{
                      curr:1
                    }
                  });
                }

              }

            });
            break;
        };

      });
      //表头工具
      table.on("toolbar(userTable)",function (obj) {
                switch (obj.event) {
                  case 'add':
                    openAddUser();
                    break;
                  case  'deleteall':
                    var checkStatus = table.checkStatus('userTable'); //idTest 即为基础参数 id 对应的值
                    console.log(checkStatus.data) //获取选中行的数据
                    console.log(checkStatus.data.length) //获取选中行数量，可作为是否有选中行的条件
                    if(checkStatus.data.length!=0){
                      var ids = "";
                      for(var i=0;i<checkStatus.data.length;i++) {
                        ids += checkStatus.data[i].userid + ",";
                      }
                      $.ajax({
                        type:"post",
                        url:"/admin/deletealluser",
                        data:{'ids':ids},
                        dataType:"json",
                        success:function (data) {
                          if("1"==data.code){
                            layer.msg(data.msg);
                            tableIns.reload({
                              url:'/admin/user',
                              page:{
                                curr:1
                              }
                            });
                          }

                        }

                      });
                    }
                    break;
                }

              }


      );
      //搜索框提交
      form.on('submit(doSerach)',function (data) {
        tableIns.reload({
          url:'/admin/user',
          where:data.field,
          page:{
            curr:1
          }
        })
        return false;

      });

      var url;
      var mainIndex;
      //打开添加页面
      function openAddUser(){
        mainIndex=layer.open({
          type:1,
          title:'添加用户',
          content:$("#saveOrUpdateDiv"),
          area:['800px','400px'],
          success:function(index){
            //清空表单数据
            $("#dataFrm")[0].reset();
            url="add";
          }
        });
      }
      //修改页面
      function openUpdateUser(data){
        mainIndex=layer.open({
          type:1,
          title:'修改用户',
          content:$("#saveOrUpdateDiv"),
          area:['800px','400px'],
          success:function(index){
            form.val("dataFrm",data);
            url="update";
          }
        });
      }
      //表单提交
      form.on("submit(doSubmit)",function(obj){
        var params=$("#dataFrm").serialize();
        if(url=="add"){
          $.post("/admin/adduser",params,function(obj){
            if(obj.code=="1"){
              layer.msg(obj.msg);
              //关闭弹出层
              layer.close(mainIndex)
              //刷新数据 表格
              tableIns.reload({
                url:'/admin/user',
                page:{
                  curr:1
                }
              });
            }else {
              layer.msg(obj.msg);
            }
          })
        }else if(url=="update"){
          $.post("/admin/updateuser",params,function(obj){
            layer.msg(obj.msg);
            //关闭弹出层
            layer.close(mainIndex)
            //刷新数据 表格
            tableIns.reload({
              url:'/admin/user',
              page:{
                curr:1
              }
            });
          })
        }
      });

    });
  </script>
</body>

</html>
